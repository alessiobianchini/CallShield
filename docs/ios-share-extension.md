# iOS Share Extension (draft skeleton)

You can add a simple Share/Action extension to let users send a phone number to CallShield from the iOS share sheet (e.g., from Contacts). This doc gives you the minimal files and steps to wire it in Xcode.

## Files to add (Swift)
Create a new target in Xcode: **File → New → Target → Action Extension** (or Share Extension). Name it `CallShieldShareExtension` and choose Swift, Embed in Application = callshieldnative.

Replace the autogenerated files with:

`ShareViewController.swift`
```swift
import UIKit
import Social

final class ShareViewController: SLComposeServiceViewController {
    override func isContentValid() -> Bool { true }
    override func didSelectPost() {
        // Extract the text (phone number) and send to the main app via URL scheme.
        let phone = contentText.trimmingCharacters(in: .whitespacesAndNewlines)
        if let url = URL(string: "callshield://report?number=\(phone)") {
            _ = openURL(url)
        }
        extensionContext?.completeRequest(returningItems: [], completionHandler: nil)
    }

    override func configurationItems() -> [Any]! { [] }

    // Helper: open URL via NSExtensionContext
    private func openURL(_ url: URL) -> Bool {
        var responder: UIResponder? = self
        let selector = sel_registerName("openURL:")
        while let r = responder {
            if r.responds(to: selector) {
                _ = r.perform(selector, with: url)
                return true
            }
            responder = r.next
        }
        return false
    }
}
```

`Info.plist` (the extension’s, not the main app)
Ensure:
```xml
<key>NSExtension</key>
<dict>
  <key>NSExtensionAttributes</key>
  <dict>
    <key>NSExtensionActivationSupportsText</key>
    <true/>
    <key>NSExtensionActivationRule</key>
    <string>TRUEPREDICATE</string>
  </dict>
  <key>NSExtensionMainStoryboard</key>
  <string></string>
  <key>NSExtensionPointIdentifier</key>
  <string>com.apple.ui-services</string>
  <key>NSExtensionPrincipalClass</key>
  <string>$(PRODUCT_MODULE_NAME).ShareViewController</string>
  <key>NSExtensionAttributes</key>
  <dict/>
</dict>
```
Set the deployment target to match the app (e.g., iOS 15+).

## URL Scheme
Main app already declares `callshield://` in `Info.plist`. The extension opens `callshield://report?number=…` which is handled in `App.tsx` deep-link logic.

## Build Settings / Signing
- In Xcode, select the extension target, set the same Team, and set its bundle id (e.g., `com.yourbundle.callshield.share`).
- Add the extension to the provisioning profile (or use automatic signing).

## Testing
1) Build the app + extension on device.
2) In Contacts or Notes, share a phone number, pick “CallShieldShareExtension”.
3) The extension opens the main app to the report modal with the number prefilled.

## Notes
- The above uses `SLComposeServiceViewController` for simplicity; you can customize the UI or validation as needed.
- If you need to pass richer data, consider a shared App Group and write to a shared container, then read it when the main app comes to foreground. For a quick “report number” deep link, the URL scheme is sufficient.
